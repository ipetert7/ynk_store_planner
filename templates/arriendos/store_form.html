{% extends "base.html" %}

{% block title %}Arriendos - {{ 'Nueva tienda' if mode == 'create' else 'Editar tienda' }}{% endblock %}

{% block content %}
<div class="container">
    {% include 'arriendos/_nav.html' %}

    <h1>{{ 'Nueva tienda' if mode == 'create' else 'Editar tienda' }}</h1>

    {% if error %}
    <div class="card" style="border-left:4px solid #dc2626;">{{ error }}</div>
    {% endif %}

    <form method="post" class="card" style="display:grid;gap:.7rem;">
        {% if mode == 'edit' and store.contract_id %}
        <input type="hidden" name="contract_id" value="{{ store.contract_id }}">
        {% endif %}

        <label>Código tienda</label>
        <input class="form-control" name="store_code" value="{{ store.store_code if store else '' }}">

        <label>Nombre tienda *</label>
        <input class="form-control" name="name" value="{{ store.name if store else '' }}" required>

        <label>Banner</label>
        <input class="form-control" name="banner" value="{{ store.banner if store else '' }}">

        <label>Ciudad</label>
        <input class="form-control" name="city" value="{{ store.city if store else '' }}">

        <label>Región</label>
        <input class="form-control" name="region" value="{{ store.region if store else '' }}">

        <label>Dirección</label>
        <input class="form-control" name="address" value="{{ store.address if store else '' }}">

        <label>Superficie m2</label>
        <input class="form-control" type="number" step="0.01" name="surface_m2" value="{{ store.surface_m2 if store else '' }}">

        <label>Estado</label>
        <select class="form-control" name="status">
            <option value="active" {% if not store or store.status == 'active' %}selected{% endif %}>Activa</option>
            <option value="closed" {% if store and store.status == 'closed' %}selected{% endif %}>Cerrada</option>
        </select>

        <label>Días de notificación</label>
        <input class="form-control" type="number" name="notification_days" min="1" value="{{ store.notification_days if store else 90 }}">

        <hr>
        <h3>Contrato activo</h3>

        <label>Inicio contrato *</label>
        <input class="form-control" type="date" name="contract_start" value="{{ store.contract_start if store else '' }}" required>

        <label>Fin contrato</label>
        <input class="form-control" type="date" name="contract_end" value="{{ store.contract_end if store else '' }}">

        <label>Arriendo base UF *</label>
        <input class="form-control" type="number" step="0.01" name="base_rent_uf" value="{{ store.base_rent_uf if store else 0 }}" required>

        <label>Arriendo variable %</label>
        <input class="form-control" type="number" step="0.01" name="variable_rent_pct" value="{{ store.variable_rent_pct if store else 0 }}">

        <label>GGCC CLP</label>
        <input class="form-control" type="number" step="1" name="ggcc_clp" value="{{ store.ggcc_clp if store else 0 }}">

        <label>Fondo promoción %</label>
        <input class="form-control" type="number" step="0.01" name="promotion_fund_pct" value="{{ store.promotion_fund_pct if store else 0 }}">

        <label>Moneda</label>
        <input class="form-control" name="currency" value="{{ store.currency if store else 'UF' }}">

        <label>Notas</label>
        <textarea class="form-control" name="notes">{{ store.notes if store else '' }}</textarea>

        <div style="display:flex;gap:.6rem;">
            <button class="nav-button" type="submit">Guardar</button>
            <a class="nav-button secondary" href="{{ url_for('arriendos.arriendos_stores') }}">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}
